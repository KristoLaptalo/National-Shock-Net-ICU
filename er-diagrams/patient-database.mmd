erDiagram
    HOSPITAL ||--o| ICU_SUBSCRIPTION : has
    HOSPITAL ||--o{ ICU_UNIT : operates
    HOSPITAL {
        int hospital_id PK
        string name
        string city
        string address
        string phone
        string type
        boolean is_active
    }

    ICU_SUBSCRIPTION {
        int subscription_id PK
        int hospital_id FK
        string subscription_tier
        date start_date
        date end_date
        boolean is_active
        int max_beds
        int max_monthly_submissions
        string contract_number UK
    }

    ICU_UNIT {
        int icu_id PK
        int hospital_id FK
        string name
        string type
        int total_beds
        boolean is_active
    }

    PATIENT ||--o{ ADMISSION : has
    PATIENT {
        int patient_id PK
        string patient_code UK
        string qr_code UK
        string encrypted_identity
        date date_of_birth
        int age
        string gender
        decimal weight_kg
        decimal height_cm
        decimal bsa
        decimal bmi
    }

    ADMISSION ||--|| MEDICAL_HISTORY : has
    MEDICAL_HISTORY {
        int history_id PK
        int admission_id FK
        int cad
        int prior_revasc
        int prior_mi
        int chronic_hf
        int valvular_disease
        int atrial_fib
        int pacemaker
        int cerebrovascular
        int prior_tia
        int hemiplegia
        int diabetes
        int hypertension
        int dyslipidemia
        int liver_disease
        int pad
        int ckd
        int dementia
        int psychiatric
        int pulmonary_disease
        int pulmonary_htn
        int connective_tissue
        int autoimmune
        int adiposity
        int gastric_disorder
        int leukemia
        int lymphoma
        int solid_tumor
        int hiv_aids
        int charlson_index
    }

    ADMISSION ||--|| WORKING_DIAGNOSIS : has
    WORKING_DIAGNOSIS {
        int diagnosis_id PK
        int admission_id FK
        int acs
        int acute_myocarditis
        int heart_failure
        int takotsubo
        int peripartum_cm
        int sepsis
        int pneumonia
        int ards
        int multi_organ_failure
        int acute_aortic
        int electrical_storm
        int pulmonary_embolism
        int trauma_cns
        int polytrauma
        int penetrating_injury
        int other_trauma
        int postpartum_hemorrhage
        int heat_shock
        int dehydration
        int drowning
        int intracerebral_hemorrhage
        int ohca
        int ihca
    }

    ADMISSION ||--|| SHOCK_CLASSIFICATION : has
    SHOCK_CLASSIFICATION {
        int classification_id PK
        int admission_id FK
        boolean cardiogenic
        string scai_stage
        boolean distributive
        string distributive_type
        boolean obstructive
        string obstructive_type
        boolean hypovolemic
        string atls_class
        boolean mixed_shock
        string congestion
        string perfusion
        int sofa_score
    }

    ADMISSION ||--o{ HEMODYNAMIC_DATA : records
    HEMODYNAMIC_DATA {
        int hemo_id PK
        int admission_id FK
        string timepoint
        int nibp_systolic
        int nibp_diastolic
        int nibp_map
        int art_systolic
        int art_diastolic
        int art_map
        int pulse
        string rhythm
        int respiratory_rate
        int spo2
        int etco2
        decimal cvp
        decimal temperature
        string monitor_device
        datetime recorded_at
    }

    ADMISSION ||--o{ ECHOCARDIOGRAPHY : has
    ECHOCARDIOGRAPHY {
        int echo_id PK
        int admission_id FK
        string timepoint
        boolean performed
        int lv_function
        int rv_function
        int lvef
        int lvef_method
        int gls
        int mitral_regurg
        int mitral_stenosis
        int aortic_regurg
        int aortic_stenosis
        int tricuspid_regurg
        int pulmonary_stenosis
        int pulmonary_regurg
        decimal lvot_vti
        decimal lvot_d
        decimal e_wave
        decimal dt_e_wave
        decimal a_wave
        decimal pv_systolic
        decimal pv_diastolic
        decimal tr_vmax
        decimal pf_accel_time
        int ivc_status
        datetime performed_at
    }

    ADMISSION ||--o{ SWAN_GANZ : has
    SWAN_GANZ {
        int sg_id PK
        int admission_id FK
        string timepoint
        boolean performed
        int pcwp
        int spap
        int mpap
        int dpap
        int srvp
        int drvp
        int rap
        decimal co_thermodilution
        decimal co_fick
        decimal cardiac_index
        decimal papi
        datetime performed_at
    }

    ADMISSION ||--o{ BLOOD_GAS : has
    BLOOD_GAS {
        int gas_id PK
        int admission_id FK
        string timepoint
        string sample_type
        string analyzer_model
        decimal ph
        decimal pco2
        decimal po2
        decimal sodium
        decimal potassium
        decimal chloride
        decimal calcium_ionized
        decimal glucose
        decimal lactate
        decimal thb
        decimal o2hb
        decimal cohb
        decimal methb
        decimal hhb
        decimal so2_measured
        decimal tco2
        decimal hco3_actual
        decimal hco3_standard
        decimal be_ecf
        decimal be_blood
        decimal anion_gap
        decimal pf_ratio
        decimal sao2
        decimal scvo2
        decimal svo2
        datetime collected_at
    }

    ADMISSION ||--o{ VENTILATOR_SETTINGS : has
    VENTILATOR_SETTINGS {
        int vent_id PK
        int admission_id FK
        string timepoint
        string device_manufacturer
        string device_model
        string vent_mode
        int fio2
        decimal peep
        decimal ps_above_peep
        decimal pinsp
        decimal ppeak
        decimal pmean
        decimal pplat
        decimal vt_set
        decimal vt_measured
        decimal vte
        int rr_set
        int rr_total
        int rr_spontaneous
        decimal mv_total
        decimal mv_spontaneous
        decimal compliance_static
        decimal compliance_dynamic
        decimal resistance
        int etco2
        datetime recorded_at
    }

    ADMISSION ||--o{ LABORATORY_RESULTS : has
    LABORATORY_RESULTS {
        int lab_id PK
        int admission_id FK
        string timepoint
        datetime collected_at
        decimal rbc
        decimal hemoglobin
        decimal hematocrit
        decimal wbc
        decimal neutrophils_abs
        decimal lymphocytes_abs
        decimal platelets
        decimal pt_inr
        decimal aptt
        decimal fibrinogen
        decimal d_dimer
        decimal bilirubin_total
        decimal ast
        decimal alt
        decimal urea
        decimal creatinine
        decimal egfr
        decimal crp
        decimal procalcitonin
        decimal troponin_i
        decimal bnp
        decimal nt_probnp
    }

    ADMISSION ||--|| PRE_ADMISSION_MEDS : has
    PRE_ADMISSION_MEDS {
        int med_id PK
        int admission_id FK
        int warfarin
        int dabigatran
        int apixaban
        int rivaroxaban
        int edoxaban
        int aspirin
        int clopidogrel
        int ticagrelor
        int prasugrel
        int beta_blocker
        int ace_inhibitor
        int arb
        int arni
        int mra
        int sglt2i
        int furosemide
        int sildenafil
        int flecainide
        int propafenone
        int verapamil_diltiazem
        int amiodarone
        int mexiletine
        int sotalol
        int dronedarone
        int other_antiarrhythmic
        int statin
        int ezetimibe
        int pcsk9i
        int metformin
        int insulin
        int dpp4i
        int pioglitazone
        int sulfonylurea
        int immunomodulator
        int corticosteroid
        int chemotherapy
        int inhaled_therapy
    }

    ADMISSION ||--o{ FOLLOW_UP : tracks
    FOLLOW_UP {
        int followup_id PK
        int admission_id FK
        string timepoint
        datetime recorded_at
        text notes
    }

    ICU_SUBSCRIPTION ||--o{ ADMISSION : allows
    ADMISSION ||--|| OUTCOME : results_in
    ADMISSION {
        int admission_id PK
        int patient_id FK
        int subscription_id FK
        int icu_id FK
        int physician_id FK
        int approved_by FK
        string case_number UK
        date date_of_admission
        date date_of_shock_onset
        int point_of_referral
        string referral_hospital
        datetime submission_date
        datetime admission_date
        string status
        string bed_number
    }

    OUTCOME {
        int outcome_id PK
        int admission_id FK
        boolean died_in_icu
        int transfer_type
        date icu_discharge_date
        boolean died_in_hospital
        date inhospital_death_date
        int discharge_destination
        date hospital_discharge_date
        int length_of_stay_icu
        int length_of_stay_hospital
    }

    PHYSICIAN ||--o{ ADMISSION : submits
    PHYSICIAN {
        int physician_id PK
        int hospital_id FK
        string first_name
        string last_name
        string specialty
        string license_number UK
        string email
    }

    ADMIN_USER ||--o{ ADMISSION : approves
    ADMIN_USER {
        int admin_id PK
        string username UK
        string password_hash
        string first_name
        string last_name
        string role
        string email UK
        boolean can_view_identity
        boolean is_active
    }

    HOSPITAL ||--o{ PHYSICIAN : employs

    AUDIT_LOG {
        int log_id PK
        string table_name
        int record_id
        string action
        json old_values
        json new_values
        int performed_by
        datetime performed_at
        string ip_address
    }
